#+TITLE: Finite Model Theory
#+AUTHOR: Heinz-Dieter Ebbinghaus@@latex:\\@@JÃ¶rg Flum

#+LATEX_HEADER: \input{../preamble.tex}
#+EXPORT_FILE_NAME: ../latex/FiniteModelTheory/FiniteModelTheory.tex
#+LATEX_HEADER: \def \Part {\text{Part}}
#+LATEX_HEADER: \def \free {\text{free}}
#+LATEX_HEADER: \def \EVEN {\text{EVEN}}
* Preliminaries

** Structures
   *Vocabularies* are finite sets that consist of *relation symbols* and
   *constant symbols*. We denote vocabularies by \tau, \sigma,\(\dots\). A
   *vocabulary* is relational if it does not contain constants.


*** Graph
   Let \(\tau=\{E\}\) with a binary relation symbol \(E\). A *graph* (or
   *undirected graph*) is a \tau-structure \(\calg=(G,E^G)\) satisfying
   1. for all \(a\in G\): not \(E^Gaa\)
   2. for all \(a,b\in G\): if \(E^Gab\) then \(E^Gba\)


   By GRAPH we denote the class of *finite* graphs. If only (1) is required, we
   speak of a *digraph*

   A subset \(X\) of the universe of a graph \(\calg\) is a *clique*, if
   \(E^Gab\) for all \(a,b\in X\), \(a\neq b\)


   Let \(\calg\) be a digraph. If \(n\ge1\) and
   \begin{equation*}
   E^Ga_0a_1,E^Ga_1a_2,\dots,E^Ga_{n-1}a_n
   \end{equation*}
   then \(a_0,\dots,a_n\) is a *path* from \(a_0\) to \(a_n\) of *length* \(n\).
   If \(a_0=a_n\), then \(a_0,\dots,a_n\) is a *cycle*. A path \(a_0,\dots,a_n\)
   is *Hamiltonian* if \(G=\{a_0,\dots,a_n\}\) and \(a_i\neq a_j\) for
   \(i\neq j\). If, in addition, \(E^Ga_na_0\) we speak of a *Hamiltonian
   circuit*


   Let \(\calg\) be a graph. Write \(a\sim b\) if \(a=b\) or if there is a path
   from \(a\) to \(b\). The equivalence class of \(a\) is called the
   *(connected) component* of \(a\). Let CONN be the class of finite connected
   graphs

   Denote by \(d(a,b)\) the length of a shortest path from \(a\) to \(b\); more
   precisely, define the *distance function* \(d:G\times G\to\N\cup\{\infty\}\)
   by
   \begin{equation*}
   d(a,b)=\infty\text{ iff }a\not\sim b,\quad d(a,b)=0\text{ iff }a=b
   \end{equation*}
   and otherwise
   \begin{equation*}
   d(a,b)=\min\{n\ge1\mid\text{there is a path from $a$ to $b$ of length $n$}\}
   \end{equation*}

   We give the following definitions only for *finite* digraphs. A vertex \(b\)
   is a successor of a vertex \(a\) if \(E^Gab\). The *in-degree* of a vertex is
   the number of its predecessors, the *out-degree* the number of its
   successors.

   A *root* of a digraph is a vertex with in-degree 0 and a *leaf* a vertex with
   out-degree 0.

   A *forest* is an acyclic digraph where each vertex has in-degree at most 1. A
   *tree* is a forest with connected underlying graph. Let TREE be the class of
   finite trees.

*** Orderings
    Let \(\tau=\{<\}\) with a binary relation symbol. A \(\tau\)-structure \(\cala=(A,<^A)\) is
    called an *ordering* if for all \(a,b,c\in A\):
    1. not \(a<^A a\)
    2. \(a<^A b\) or \(b<^A a\) or \(a=b\)
    3. if \(a<^Ab\) and \(b<^Ac\) then \(a<^Ac\)
*** Operations on Structures
    Two \(\tau\)-structures \(\cala\) and \(\calb\) are *isomorphic*, written \(\calc\cong\calb\), if
    there is an isomorphism from \(\cala\) to \(\calb\), i.e., a bijection \(\pi:A\to B\) preserving
    relations and constants, that is
    - for \(n\)-ary \(R\in \tau\) and \(a_1,\dots,a_n\in A\)
      \begin{equation*}
      R^Aa_1\dots a_n \quad\text{ iff }\quad
      R^B\pi(a_i)\dots\pi(a_n)
      \end{equation*}
    - for \(c\in\tau\), \(\pi(c^A)=\pi(c^B)\)


    For relational \tau we introduce the *union* (or, *disjoint union*) of structures. Assume
    that \(\cala\) and \(\calb\) are \(\tau\)-structures with \(A\cap B=\emptyset\).
    Then \(\cala\dot{\cup}\calb\), the *union* of \(\cala\) and \(\calb\), is the \(\tau\)-structure
    with domain \(A\cup B\) and
    \begin{equation*}
    R^{\cala\dot\cup\calb}:=R^{\cala}\cup R^{\cala}
    \end{equation*}
    for any \(R\) in \tau

    Note that the union of ordered structures is not an ordered structure. The situation is
    different for the so-called *ordered sum*: let \(\tau\) with \(<\in\tau\) be relational and
    let \(\cala\) and \(\calb\) be ordered \(\tau\)-structures. Assume that \(A\cap B=\emptyset\).
    Define \(\cala\lhd\calb\), the *ordered sum* of \(\cala\) and \(\calb\) as \(\cala\dot\cup\calb\)
    but setting
    \begin{equation*}
    <^{\cala\dot\cup\calb}:=<^{\cala}\cup <^{\calb}\cup
    \{(a,b)\mid a\in A,b\in B\}
    \end{equation*}
** Syntax and Semantics of First-Order Logic
   Fix a vocabulary \tau. Each formula of first-order logic will be a string of symbols taken from the
   alphabet consisting of
   - variables
   - connectives
   - existential quantifier
   - equality symbol
   - )(
   - the symbols in \tau
   
    Denote \(\FO[\tau]\) the set of formulas of first-order logic of vocabulary
    \tau.

    The axioms for graphs stated above have the following formalizations in \(\FO[\{E\}]\)
    \begin{align*}
    &\forall x\neg Exx\\
    &\forall x\forall y(Exy\to Eyx)
    \end{align*}

    When only taking into consideration finite structures, we use the notation
    \(\Phi\models_{\fin}\psi\)

    The *quantifier rank* \(\qr(\varphi)\) of a formula \varphi is the maximum
    number of nested quantifiers occurring in it

    It can be shown that every first-order formula is logically equivlent to a
    formula in prenex normal form, that is, to a formula of the form
    \(Q_1x_1,\dots,Q_sx_s\psi\) where \(Q_1,\dots,Q_s\in\{\forall,\exists\}\),
    and where \psi is quantifier-free. Such a formula is called \(\Sigma_n\) if
    the string of \(n\) consecutive blocks, where in each block all quantifiers
    all of the same type, adjacent blocks contain quantifiers of different type,
    and the first block is existential. \(\Pi_n\) formulas are defined in the
    same way but now we require that the first block consists of universal
    quantifiers. A \(\Delta_n\)-formula is a formula logically equivalent to
    both a \(\Sigma_n\)-formula and a \(\Pi_n\)-formula

    Given a formula \(\varphi(x,\overbar{z})\) and \(n\ge1\),
    \begin{equation*}
    \exists^{\ge n}x\varphi(x,\overbar{z})
    \end{equation*}
    is an abbreviation for the formula
    \begin{equation*}
    \exists x_1,\dots\exists x_n(
    \bigwedge_{1\le i\le n}\varphi(x_i,\overbar{z})\wedge
    \bigwedge_{1\le i<j\le n}\neg x_i=x_j)
    \end{equation*}

    We set
    \begin{equation*}
    \varphi_{\ge n}:=\exists^{\ge n}x\;x=x
    \end{equation*}
    Clearly
    \begin{equation*}
    \cala\models\varphi_{\ge n}\quad\text{ iff }\quad\norm{A}\ge n
    \end{equation*}

** Some Classical Results of First-Order Logic
    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:thm1.0.2
    The set of logically valid sentences of first-order logic is r.e.
    #+END_theorem
    #+ATTR_LATEX: :options [Compactness Theorem]
    #+BEGIN_theorem
    label:thm1.0.3
    \Phi is satisfiable iff every finite subset of \Phi is satisfiable
    #+END_theorem

    Neither Theorem ref:thm1.0.2 nor ref:thm1.0.3 remain valid if one only
    considers finite structures. A counterexample for the Compactness Theorem is
    given by the set \(\Phi_\infty:=\{\varphi_{\ge n}\mid n\ge1\}\): Each finite
    subset of \(\Phi_\infty\) has a finite model, but \(\Phi_\infty\) has no
    finite model

    The failure of Theorem ref:thm1.0.2 is documented by
    #+ATTR_LATEX: :options [Trahtenbrot's Theorem]
    #+BEGIN_theorem
    The set of sentences of first-order logic valid in all finite structures is
    not r.e.
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:lemma1.0.6
    Let \(\varphi\in\FO[\tau]\) and for \(i\in I\), let
    \(\Phi^i\subseteq\FO[\tau]\). Assume that
    \begin{equation*}
    \models\varphi\leftrightarrow\bigvee_{i\in I}\bigwedge\Phi^i
    \end{equation*}
    Then there is a finite \(I_0\subseteq I\) and for every \(i\in I_0\), a
    finite \(\Phi^i_0\subseteq\Phi^i\) s.t.
    \begin{equation*}
    \models\varphi\leftrightarrow\bigvee_{i\in I_0}\bigwedge\Phi^i_0
    \end{equation*}
    #+END_lemma

    #+BEGIN_proof
    For simplicity we assume that \varphi is a sentence and that every
    \(\Phi^i\) is a set of sentences. By hypothesis, for some \(i\in I\), we
    have \(\Phi^i\models\varphi\); hence, by the Compactness Theorem,
    \(\Phi^i_0\models\varphi\) for some finite \(\Phi^i_0\subseteq\Phi^i\).

    If there is not such \(I_0\) with
    \(\models\varphi\to\bigvee_{i\in I_0}\bigwedge\Phi_0^i\), then each finite subset of
    \(\{\varphi\}\cup\{\neg\bigwedge\Phi^i_0\mid i\in I\}\) has a model. Hence by
    the Compactness Theorem, there is a contradiction
    
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    Let \Phi be a set of first-order sentences. Assume that any two structures
    that satisfy the same sentences of \Phi are elementarily equivalent. Then
    any first-order sentence is equivalent to a boolean combination of sentences
    of \Phi
    #+END_corollary

    #+BEGIN_proof
    For any structure \(\cala\) set
    \begin{equation*}
    \Phi(\cala):=\{\psi\mid\psi\in\Phi,\cala\models\psi\}\cup
    \{\neg\psi\mid\psi\in\Phi,\cala\models\neg\psi\}
    \end{equation*}
    Let \(\varphi\) be any first-order sentence. By the preceding lemma it
    suffices to show that
    \begin{equation*}
    \models\varphi\leftrightarrow\bigvee_{\cala\models\phi}\bigwedge\Phi(\cala)
    \end{equation*}
    If \(\calb\models\varphi\) then
    \(\calb\models\bigvee_{\cala\models\varphi}\bigwedge\Phi(\cala)\). Suppose
    \(\cala\models\bigvee_{\cala\models\varphi}\bigwedge\Phi(\cala)\). Then for
    some model \(\cala\) of \varphi, \(\calb\models\Phi(\cala)\). By the
    definition of \(\Phi(\cala)\), \(\cala\) and \(\calb\) satisfy the same
    sentences of \Phi
    #+END_proof

** Model Classes and Global Relations
    Fix a vocabulary \tau. For a sentence \varphi of \(\FO[\tau]\) we denote by
    \(\Mod(\varphi)\) the class of *finite* models of \varphi.

    \(\Mod(\varphi)\) is closed under isomorphisms

    For \(\varphi(x_1,\dots,x_n)\in\FO[\tau]\) and a structure \(\cala\) let
    \begin{equation*}
    \varphi^{\cala}(-):=\{(a_1,\dots,a_n)\mid\cala\models\varphi[a_1,\dots,a_n]\}
    \end{equation*}
    be the set of \(n\)-tuples *defined by \varphi in \(\cala\)*. For \(n=0\) this be read as
    \begin{equation*}
    \varphi^{\cala}:=
    \begin{cases}
    \text{TRUE}&\text{if }\cala\vDash\varphi\\
    \text{FALSE}&\text{if }\calb\not\vDash\varphi
    \end{cases}
    \end{equation*}

    Use this notation we have
    \begin{equation*}
    \text{if }\pi:\cala\cong\calb\text{ then }\pi(\varphi^{\cala}(-)=\varphi^{\calb}(-))
    \end{equation*}
    where for \(X\subseteq A^n\) we set \(\pi(X):=\{\pi(a_1),\dots,\pi(a_n)\mid (a_1,\dots,a_n)\in X\}\)

    *Throughout the book all classes \(K\) of structures considered will tacitly be assumed to be*
    *closed under isomorphisms*, i.e.
    \begin{equation*}
    \cala\in K \text{ and }\cala\cong\calb
    \text{ implies }\calb\in K
    \end{equation*}

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(K\) be a class of \(\tau\)-structures. An \(n\)-ary
    *global relation
    \Gamma on \(K\)* is a mapping assigning to each \(A\in K\) an \(n\)-ary
    relation \(\Gamma(\cala)\) on \(\cala\) satisfying
    \begin{equation*}
    \Gamma(\cala)a_1\dots a_n\quad\text{ iff }\quad\Gamma(\calb)\pi(a_1)\dots\pi(a_n)
    \end{equation*}
    for every isomorphism \(\pi:\cala\cong\calb\) and every
    \(a_1,\dots,a_n\in A\). If \(K\) is the class of all finite \(\tau\)-structures,
    then we just speak of an \(n\)-ary *global relation*
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    1. Any formula \(\varphi(x_1,\dots,x_n)\in\FO[\tau]\) defines the global
       relation
       \(\cala\mapsto\varphi^{\cala}(-)\)
    2. The "transitive closure relation" TC is the binary global relation on
       GRAPH with
       \begin{equation*}
       \TC(\calg):=\{(a,b)\mid a,b\in G,\text{ there is a path from $a$ to $b$}\}
       \end{equation*}
    3. For \(m\ge0\), \(\Gamma_m\) is a unary global relation on GRAPH, where
       \begin{equation*}
       \Gamma_m(\calg):=\{a\mid\norm{\{b\in G\mid E^Gab\}}=m\}
       \end{equation*}
       is the set of elements of \(\calg\) of degree \(m\)
    #+END_examplle

    An important issue in model theory is the study of properties of classes of structures that are
    axiomatizable in a given logic \(\call\) and in particular to determine what classes of
    structures are axiomatizable are what global relations are definable in \(\call\).

** Relational Databases and Query Languages
* EhrenfeuchtâFraÃ¯ssÃ© Method

** Elementary Classes
   #+ATTR_LATEX: :options []
   #+BEGIN_proposition
   Every finite structure can be characterized in first-order logic up to
   isomorphism, i.e., for every finite structure \(\cala\) there is a sentence
   \(\varphi_{\cala}\) of first-order logic s.t. for all structures \(\calb\) we
   have
   \begin{equation*}
   \calb\models\varphi_{\cala}\quad\text{ iff }\quad\cala\cong\calb
   \end{equation*}
   #+END_proposition

   #+BEGIN_proof
   Suppose \(A=\{a_1,\dots,a_n\}\). Set \(\overbar{a}=a_1\dots a_n\). Let
   \begin{align*}
   \Theta_n:=\{\psi\mid\psi\text{ has the form }&Rx_1\dots x_k,x=y\text{ or }c=x,\\
   &\text{and variables among }v_1,\dots,v_n\}
   \end{align*}
   and
   \begin{align*}
   \varphi_{\cala}&:=\exists v_1\dots\exists v_n(\bigwedge\{\psi\mid\psi\in\Theta_n,
   \cala\models\psi[\overbar{a}]\}\wedge\\
   &\bigwedge\{\neg\psi\mid\psi\in\Theta_n,\cala\models\neg\psi[\overbar{a}]\}\wedge
   \forall v_{n+1}(v_{n+1}=v_n\vee\dots\vee v_{n+1}=v_n))
   \end{align*}
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_corollary
   Let \(K\) be a class of finite structures. Then there is a set \Phi of
   first-order sentences s.t.
   \begin{equation*}
   K=\Mod(\Phi)
   \end{equation*}
   that is, \(K\) is the class of finite models of \Phi
   #+END_corollary

   #+BEGIN_proof
   For each \(n\) there is only a finite number of pairwise nonisomorphic
   structures of cardinality \(n\). Let \(\cala_1,\dots,\cala_k\) be a maximal
   subset of \(K\) of pairwise nonisomorphic structures of cardinality \(n\).
   Set
   \begin{equation*}
   \psi_n:=(\varphi_{=n}\to(\varphi_{\cala_1}\vee\dots\vee\varphi_{\cala_k}))
   \end{equation*}
   Then \(K=\Mod(\{\psi_n\mid n\ge1\})\)
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_definition
   Let \(K\) be a class of finite structures. \(K\) is called
   *axiomatizable in first-order logic* or *elementary* if there is a setence
   \varphi of first-order logic s.t. \(K=\Mod(\varphi)\)
   #+END_definition

   For structures \(\cala\) and \(\calb\) and \(m\in\N\) we write
   \(\cala\equiv_m\calb\) and say that \(\cala\) and \(\calb\) are
   *\(m\)-equivalent* if \(\cala\) and \(\calb\) satisfy the same first-order
   sentences of quantifier rank \(\le m\)

   #+ATTR_LATEX: :options []
   #+BEGIN_theorem
   label:thm2.1.4
   Let \(K\) be a class of finite structures. Suppose that for every \(m\) there
   are fintie structures \(\cala\) and \(\calb\) s.t.
   \begin{equation*}
   \cala\in K,\calb\not\in K,\text{ and }\cala\equiv_m\calb
   \end{equation*}
   Then \(K\) is not axiomatizable in first-order logic
   #+END_theorem

   #+BEGIN_proof
   Let \(\varphi\) be any first-order sentence. Set \(m:=\qr(\varphi)\). By out assumption there
   are \(\cala\) and \(\calb\) s.t. \(\cala\in K, \calb\not\in K\), and \(\cala\equiv_m\calb\).
   Hence \(K\neq\Mod(\varphi)\)
   #+END_proof
   
** Ehrenfeucht's Theorem

   #+ATTR_LATEX: :options []
   #+BEGIN_definition
   Assume \(\cala\) and \(\calb\) are structures. Let \(p\) be a map with
   \(\dom(p)\subseteq A\). Then \(p\) is said to be a *partial isomorphism* from \(\cala\)
   to \(\calb\) if
   1. \(p\) is injective
   2. for every \(c\in\tau\):\(c^{\cala}\in\dom(p)\) and \(p(c^{\cala})=c^{\calb}\)
   3. for every \(n\)-ary \(R\in\tau\) and all \(a_1,\dots,a_n\in\dom(p)\)
      \begin{equation*}
      R^{\cala}a_1\dots a_n \quad\text{ iff }\quad
      R^{\calb}p(a_1)\dots p(a_n)
      \end{equation*}

   We write \(\Part(\cala,\calb)\) for the set of partial isomorphisms from \(\cala\) to \(\calb\)
   #+END_definition

   In the following we identify a map \(p\) with its graph \(\{(a,p(a))|a\in\dom(p)\}\).
   Then \(p\subseteq q\) means that \(q\) is an extension of \(p\)

   #+BEGIN_remark
   1. The empty map, \(p=\emptyset\), is a partial isomorphism from \(\cala\) to \(\calb\) just in
      case the vocabulary contains no constants
   2. If \(p\neq\emptyset\) is a map with \(\dom(p)\subseteq A\) and \(\ran(p)\subseteq B\),
      then \(p\) is a partial isomorphism from \(\cala\) to \(\calb\) iff \(\dom(p)\)
      contains \(c^{\cala}\) for all constants \(c\in\tau\) and \(p:\dom(p)^{\cala}\cong\ran(p)^{\calb}\)
   3. For \(\bar{a}=a_1\dots a_s\in A\) and \(\bar{b}=b_1\dots b_s\in B\) the following statements
      are equivalent
      1. the clauses
         \begin{equation*}
         p(a_i)=b_i\text{ for }i=1,\dots,s
         \end{equation*}
         and
         \begin{equation*}
         p(c^{\cala})=c^{\calb}\text{ for }c\text{ in }\tau
         \end{equation*}
         define a map, which is a partial isomorphism from \(\cala\) to \(\calb\) (henceforth
         denoted by \(\bar{a}\mapsto\bar{b}\))
      2. for all quantifier-free \(\varphi(v_1,\dots,v_s)\):
         \(\cala\vDash\varphi[\bar{a}]\) iff
         \(\calb\vDash\varphi[\bar{b}]\)
      3. for all atomic \(\varphi(v_1,\dots,v_s)\):
         \(\cala\vDash\varphi[\bar{a}]\) iff
         \(\calb\vDash\varphi[\bar{b}]\)         
   #+END_remark

   In general, a *partial isomorphism does not preserve the validity of formulas with quantifiers*:
   Let \(\tau=\{<\}\), \(\cala=(\{0,1,2\},<)\), \(\calb=(\{0,1,2,3\},<)\) whre in both cases <
   denotes the natural ordering. Then \(p_0:=02\mapsto 01\) is a partial isomorphism from \(\cala\)
   to \(\calb\) s.t.
   \begin{equation*}
   \cala\vDash\exists v_3(v_1<v_3\wedge v_3<v_2)[0,2]
   \end{equation*}
   but
   \begin{equation*}
   \calb\not\vDash\exists v_3(v_1<v_3\wedge v_3<v_2)[p_0(0),p_0(2)]
   \end{equation*}
   
   

   Let \(\cala\) and \(\calb\) be \(\tau\)-structures, \(\bar{a}\in A^s\),
   \(\overbar{b}\in B^s\), and \(m\in\N\). The *Ehrenfeucht game*
   \(G_m(\cala,\overbar{a},\calb,\overbar{b})\) is played by two players called
   the *spoiler* and the *duplicator*. Each player has to make \(m\) moves in
   the course of a play. In his \(i\)-th move the spoiler first selects a
   structure, \(\cala\) or \(\calb\), and an element in this structure. If the
   spoiler chooses \(e_i\) in \(\cala\) then the duplicator in his \(i\)-th move
   must choose an element \(f_i\) in \(\calb\). If the spoiler chooses \(f_i\)
   in \(\calb\) then the duplicator must choose an element \(e_i\) in \(\cala\)

   #+ATTR_LATEX: :align cc|c
   |               | \(\cala,\overbar{a}\) | \(\calb,\overbar{b}\) |
   |---------------+-----------------------+-----------------------|
   | first move    | \(e_1\)               | \(f_1\)               |
   | second move   | \(e_2\)               | \(f_2\)               |
   | \(\vdots\)    | \(\vdots\)            | \(\vdots\)            |
   | \(m\)-th move | \(e_m\)               | \(f_m\)               |

   The duplicator *wins* iff
   \(\overbar{a}\overbar{e}\mapsto\overbar{b}\overbar{f}\in\Part(\cala,\calb)\).

   Equivalently, the spoiler wins if after
   some \(i\le m\), \(\bar{a}e_1\dots e_i\mapsto\bar{b}f_1\dots f_i\) is not a partial isomorphism.
   We say that a player, the spoiler or the duplicator, has a *winning strategy*
   in \(G_m(\cala,\bar{a},\calb,\bar{b})\), or shortly, that he
   *wins* \(G_m(\cala,\bar{a},\calb,\bar{b})\), if it is possible for him to win each play whatever
   choices are made by the opponent.

   If \(s=0\), we denote the game by \(G_m(\cala,\calb)\)

   #+ATTR_LATEX: :options []
   #+BEGIN_lemma
   1. If \(A\cong B\) then the duplicator wins \(G_m(\cala,\calb)\)
   2. If the duplicator wins \(G_{m+1}(\cala,\calb)\) and \(\norm{A}\le m\) then \(\cala\cong\calb\)
   #+END_lemma

   #+ATTR_LATEX: :options []
   #+BEGIN_lemma
   label:lemma2.2.4
   Let \(\cala\) and \(\calb\) be structures, \(\bar{a}\in A^s\), \(\bar{b}\in B^s\), and \(m\ge0\)
   1. The duplicator wins \(G_0(\cala,\bar{a},\calb,\bar{b})\) iff \(\bar{a}\mapsto\bar{b}\) is a
      partial isomorphism
   2. For \(m>0\) the following are equivalent
      1. The duplicator wins \(G_m(\cala,\bar{a},\calb,\bar{b})\)
      2. For all \(a\in A\) there is \(b\in B\) s.t. the duplicator wins the
         game \(G_{m-1}(\cala,\bar{a}a,\calb,\bar{b}b)\) and for all \(b\in B\) there is
         a \(a\in A\) s.t. the duplicator wins \(G_{m-1}(\cala,\bar{a}a,\calb,\bar{b}b)\)
      3. If the duplicator wins \(G_m(\cala,\bar{a},\calb,\bar{B})\) and if \(m'<m\) the duplicator
         wins \(G_{m'}(\cala,\bar{a},\calb,\bar{b})\)
   #+END_lemma

   Let \(\cala\) be given. For \(\bar{a}=a_1\dots a_s\in A\) and \(m\ge0\) we introduce a formula
   \(\varphi^m_{\bar{a}}(v_1,\dots,v_s)\) that describes the game-theoretic properties
   of \(\bar{a}\) in any game \(G_m(\cala,\bar{a},\dots)\) s.t. for any \(\calb\)
   and \(\bar{b}=b_1\dots b_s\in B\)
   \begin{equation*}
   \calb\vDash\varphi^m_{\bar{a}}[\bar{b}]
   \quad\text{ iff }\quad
   \text{the duplicator wins }G_m(\cala,\bar{a},\calb,\bar{b})
   \end{equation*}

   #+ATTR_LATEX: :options []
   #+BEGIN_definition
   Let \(\bar{v}\) be \(v_1,\dots,v_s\)
   \begin{equation*}
   \varphi^0_{\bar{a}}:=\bigwedge
   \{\varphi(\bar{v})\mid\varphi\text{ atomic or negated atmoic}, \cala\vDash\varphi[\bar{a}]\}
   \end{equation*}
   (atomic diagram of \(\cala\)) and for \(m>0\)
   \begin{equation*}
   \varphi_{\bar{a}}^m(\bar{v}):=
   \bigwedge_{a\in A}\exists v_{s+1}\varphi_{\bar{a}a}^{m-1}(\bar{v},v_{s+1})\wedge
   \forall v_{s+1}\bigvee_{a\in A}\varphi_{\bar{a}a}^{m-1}(\bar{v},v_{s+1})
   \end{equation*}
   \(\varphi_{\bar{a}^0}\) describes the isomorphism type of the substructure generated
   by \(\bar{a}\) in \(\cala\); and for \(m>0\) the formula \(\varphi_{\bar{a}}^m\) tells us to
   which isomorphism types the tuple \(\bar{a}\) can be extended in \(m\) steps adding one element
   in each step. \(\varphi_{\bar{a}}^m\) is called the *\(m\)-isomorphism type* (or *\(m\)-Hintikka
   formula*) of \(\bar{a}\) in \(\cala\)
   #+END_definition

   Since \(\varphi(v_1,\dots,v_s)\mid \varphi\text{ atomic or negated atmoic}\) is finite, a simple
   induction on \(m\) shows

   #+ATTR_LATEX: :options []
   #+BEGIN_lemma
   For \(s,m\ge0\), the
   set \(\{\varphi_{\cala,\bar{a}}^m\mid \cala\text{ a structure and }\bar{a}\in A^s\}\) is finite
   #+END_lemma

   #+ATTR_LATEX: :options []
   #+BEGIN_lemma
   1. \(\qr(\varphi_{\bar{a}}^m)=m\)
   2. \(\cala\vDash\varphi_{\bar{a}}^m[\bar{a}]\)
   3. For any \(\calb\) and \(\bar{b}\) in \(B\)
      \begin{equation*}
      \calb\vDash\varphi_{\bar{a}}^0[\bar{b}] \quad\text{ iff }\quad
      \bar{a}\mapsto\bar{b}\in\Part(\cala,\calb)
      \end{equation*}
   #+END_lemma

   #+ATTR_LATEX: :options [Ehrenfeucht's Theorem]
   #+BEGIN_theorem
   label:thm2.2.8
   Given \(\cala\) and \(\calb\), \(\bar{a}\in A^s\) and \(\bar{b}\in B^s\), and \(m\ge0\), the
   following are equivalent
   1. The duplicator wins \(G_m(\cala,\bar{a},\calb,\bar{b})\)
   2. \(\calb\vDash\varphi_{\bar{a}}^m[\bar{b}]\)
   3. \(\bar{a}\) and \(\bar{b}\) satisfy the same formulas of quantifier rank \(\le m\), that is,
      if \(\varphi(x_1,\dots,x_s)\) is of quantifier rank \(\le m\), then
      \begin{equation}
      \label{eq:2.2.8}
      \cala\vDash\varphi[\bar{a}] \quad\text{ iff }\quad
      \calb\vDash\varphi[\bar{b}]
      \end{equation}
   #+END_theorem

   #+BEGIN_proof
   \(1\leftrightarrow 2\). Induction on \(m\). For \(m=0\)
   \begin{align*}
   \text{the duplicator wins }G_0(\cala,\bara,\calb,\barb)
   &\quad\text{ iff }\quad
   \bara\mapsto\barb\in\Part(\cala,\calb)\\
   &\quad\text{ iff }\quad
   \calb\vDash\varphi_{\bara}^0[\barb]
   \end{align*}
   For \(m>0\)
   |     | the duplicator wins \(G_m(\cala,\bara,\calb,\barb)\)                                                                                                               |
   | iff | for all \(a\in A\),there is \(b\in B\) s.t. the duplicator wins                                                                                                    |
   |     | \(G_{m-1}(\cala,\bara a,\calb,\barb b)\), and for all \(b\in B\) there is \(a\in A\) s.t.                                                                          |
   |     | the duplicator wins \(G_{m-1}(\cala,\bara a,\calb,\barb b)\)                                                                                                       |
   | iff | for all \(a\in A\), there is \(b\in B\) with \(\calb\vDash\varphi_{\bara a}^{m-1}[\barb b]\) , and                                                                 |
   |     | for all \(b\in B\), there is \(a\in A\) with \(\calb\vDash\varphi_{\bara a}^{m-1}[\barb b]\)                                                                       |
   | iff | \(\calb\vDash\bigwedge_{a\in A}\exists v_{s+1}\varphi_{\bara a}^{m-1}(\barv,v_{s+1})\wedge\forall v_{s+1}\bigvee_{a\in A}\varphi_{\bara a}^{m-1}(\barv,v_{s+1})[\barb]\) |
   | iff | \(\calb\vDash\varphi_{\bara}^m[\barb]\)                                                                                                                            |
   
   \(3\to1\). \(\qr(\varphi^m_{\bar{a}})=m\) and \(\cala\vDash\varphi_{\bar{a}}^m[\bar{a}]\)

   \(1\to 3\). Induction on \(m\). The case \(m=0\) is handled as above. Let \(m>0\) and suppose
   that the duplicator wins \(G_m(\cala,\bara,\calb,\barb)\).  Clearly the set of formulas
   \(\varphi(x_1,\dots,x_s)\) satisfying 
   ref:eq:2.2.8 contains the atomic formulas and is closed under \(\neg\) and \(\vee\) (Since
   duplicator wins the game, there are partial isomorphisms). Suppose that
   \(\varphi(\bara)=\exists y\psi\) and \(\qr(\varphi)\le m\). Since \(y\not\in\free(\varphi)\), we can assume
   that \(y\) is distinct from the variables in \(\barx\). Hence \(\psi=\psi(\barx,y)\). Assume, for
   instance, \(\cala\vDash\varphi(\bara)\). Then there is \(a\in A\) s.t.
   \(\cala\vDash\psi[\bara,a]\). As by 1, the duplicator wins \(G_m(\cala,\bara,\calb,\barb)\),
   there is \(b\in B\) s.t. the duplicator wins \(G_{m-1}(\cala,\bara a,\calb,\barb b)\).
   Since \(\qr(\psi)\le m-1\), the induction hypothesis yields
   \(\calb\vDash\psi[\barb,b]\), hence \(\calb\vDash\varphi[\barb]\)
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_corollary
   For structures \(\cala,\calb\) and \(m\ge0\) the following are equivalent
   1. The duplicator wins \(G_m(\cala,\calb)\)
   2. \(\calb\vDash\varphi_{\cala}^m\)
   3. \(\cala\equiv_m\calb\)
   #+END_corollary

   #+ATTR_LATEX: :options []
   #+BEGIN_corollary
   Let \(\cala\) be a structure with \(\norm{A}\le m\). Then for all \(\calb\)
   \begin{equation*}
   \calb\vDash\varphi_{\cala}^{m+1}
   \quad\text{ iff }\quad
   \cala\cong\calb
   \end{equation*}
   #+END_corollary

   The next result shows that the formulas \(\varphi_{\bara}^m\) give a clear picture of the
   expressive power of first-order logic

   #+ATTR_LATEX: :options []
   #+BEGIN_theorem
   Let \(\varphi(v_1,\dots,v_s)\) be a formula of quantifier rank \(\le m\). Then
   \begin{equation*}
   \vDash\varphi\leftrightarrow
   \bigvee
   \{\varphi_{\cala,\bara}^m\mid\cala\text{ a structure },
   \bara\in\cala,\text{ and }\cala\vDash\varphi[\bara]\}
   \end{equation*}
   #+END_theorem

   #+BEGIN_proof
   Suppose first that \(\calb\vDash\varphi[\barb]\). Then the formula \(\varphi_{\calb,\barb}^m\) is
   a member of the disjunction on the right side of the equivalence, which therefore is satisfied
   by \(\barb\).

   Conversely, suppose \(\calb\vDash\bigvee\{\varphi_{\cala,\bara}^m[\bara]\}[\barb]\). Then for
   some \(\cala\) and \(\bara\) s.t. \(\cala\vDash\varphi[\bara]\) we
   have \(\calb\vDash\varphi_{\cala,\bara}^m[\barb]\). By Theorem ref:thm2.2.8 \(\bara\)
   and \(\barb\) satisfy the same formulas of quantifier rank \(\le m\) and therefore \(\calb\vDash\varphi[\barb]\).
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_theorem
   label:thm2.2.12
   For a class \(K\) of finite structures the following are equivalent
   1. \(K\) is not axiomatizable in first-order logic
   2. For each \(m\) there are finite structures \(\cala\) and \(\calb\) s.t.
      \begin{equation*}
      \cala\in K,\calb\not\in K\text{ and }\cala\equiv_m\calb
      \end{equation*}
   #+END_theorem

   #+BEGIN_proof
   \(2\to1\) is proved in theorem ref:thm2.1.4. For the converse, suppose that 2 doesn't hold, i.e.,
   that for some \(m\) and all finite \(\cala\) and \(\calb\)
   \begin{equation*}
   \cala\in K\text{ and }\cala\equiv_m\calb\text{ imply }\calb\in K
   \end{equation*}
   Then \(K=\Mod(\bigvee\{\varphi_{\cala}^m\mid \cala\in K\})\), and thus \(K\) is axiomatizable
   #+END_proof

   
** Examples and FraÃ¯ssÃ©'s Theorem
   Given structures \(\cala,\calb\) and \(m\in\N\), let \(W_m(\cala,\calb):=\)
   \begin{equation*}
   \{\bara\mapsto\barb\mid s\ge0,\bara\in A^s,\barb\in B^s,\text{ the duplicator wins }
   G_m(\cala,\bara,\calb,\barb)\}
   \end{equation*}
   be the set of winning positions for the duplicator. The sequence of the \(W_M(\cala,\calb)\) has
   the back and forth properties as introduced in the following definition

   #+ATTR_LATEX: :options []
   #+BEGIN_definition
   Structures \(\cala\) and \(\calb\) are said to be *\(m\)-isomorphic*,
   written \(\cala\cong_m\calb\), if there is a sequence \((I_j)_{j\le m}\) with the following
   properties
   1. Every \(I_j\) is a nonempty set of partial isomorphisms from \(\cala\) to \(\calb\)
   2. (*Forth property*) For every \(j<m\), \(p\in I_{j+1}\) and \(a\in A\) there is \(q\in I_j\)
      s.t. \(q\supseteq p\) and \(a\in\dom(q)\)
   3. (*Back property*) For every \(j<m\), \(p\in I_{j+1}\), and \(b\in B\) there is \(q\in I_j\)
      s.t. \(q\supseteq p\) and \(b\in\ran(q)\)


   If \((I_j)_{j\le m}\) has the properties 1,2 and 3, we write \((I_j)_{j\le m}:\cala\cong_m\calb\)
   and say that \(\cala\) and \(\calb\) are *\(m\)-isomorphic via* \((I_j)_{j\le m}\)
   #+END_definition

   #+BEGIN_exercise
   label:ex2.3.2
   Supppose \((I_j)_{j\le m}:\cala\cong_m\calb\).
   Then \((\tilde{I}_j)_{j\le m}:\cala\cong_m\calb\)
   with \(\tilde{I}_j:=\{q\in\Part(\cala,\calb)\mid q\subseteq p\text{ for some }p\in I_j\}\).
   In particular, \(\emptyset\mapsto\emptyset\in I_j\) for all \(j\le m\). Moreover

   \(\widetilde{W_j(\cala,\calb)}=W_j(\cala,\calb)\)

   #+END_exercise

   #+BEGIN_proof
   Forth property: Suppose \(j<m\), \(p\in \tilde{I}_{j+1}\) and \(a\in A\).
   Then \(p\subseteq p'\in I_{j+1}\). Then we have \(q'\in I_{j}\) with \(a\in\dom(q')\)
   and \(p'\subseteq q'\). We construct \(q=p\cup\{(a,q'(a))\}\). \(q\in\Part(\cala,\calb)\)
   since \(q'\in\Part(\cala,\calb)\).

   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_theorem
   For structures \(\cala\) and \(\calb\), \(\bara\in A^s\), \(\barb\in B^s\) and \(m\ge0\) the
   following are equivalent
   1. The duplicator wins \(G_m(\cala,\bara,\calb,\barb)\)
   2. \(\bara\mapsto\barb\in W_m(\cala,\calb)\) and \((W_j(\cala,\calb))_{j\le m}:\cala\cong_m\calb\)
   3. There is \((I_j)_{j\le m}\) with \(\bara\mapsto\barb\in I_m\) s.t. \((I_j)_{j\le m}:\cala\cong_m\calb\)
   4. \(\calb\vDash\varphi_{\bara}^m[\barb]\)
   5. \(\bara\) satisfies in \(\cala\) the same formulas of quantifier rank \(\le m\) as \(\barb\)
      in \(\calb\)
   #+END_theorem

   #+BEGIN_proof
   \(1\to2\). For each \(\bara\mapsto\barb\in W_m(\cala,\calb)\), by Lemma ref:lemma2.2.4 the
   duplicator wins \(G_0(\cala,\bara,\calb,\barb)\) as the duplicator wins
   \(G_m(\cala,\bara,\calb,\barb)\). For \(j<m\), \(\bara\mapsto\barb\in W_{j+1}(\cala,\calb)\)
   and \(a\in A\). We have \(\bara a\mapsto\barb b\in W_j(\cala,\calb)\) for some \(b\in B\).

   \(2\to 3\). Obvious

   \(3\to1\). Suppose that \((I_j)_{j\le m}:\cala\cong_m\calb\) and \(\bara\mapsto\barb\in I_m\). We
   describe a winning strategy in \(G_m(\cala,\bara,\calb,\barb)\) for the duplicator: in his
   \(i\)-th move he should choose the element \(e_i\) s.t. for
   \(p_i:\bara e_1\dots e_i\mapsto\barb f_1\dots f_i\) it is true that \(p_i\subseteq q\) for some
   \(q\in I_{m-i}\); this is always possible because of the back and forth properties of
   \((I_j)_{j\le m}\)
   
   
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_corollary
   For structures \(\cala, \calb\) and \(m\ge0\) the following are equivalent
   1. the duplicator wins \(G_m(\cala,\calb)\)
   2. \((W_j(\cala,\calb))_{j\le m}:\cala\cong_m\calb\)
   3. \(\cala\cong_m\calb\)
   4. \(\calb\vDash\varphi_{\cala}^m\)
   5. \(\cala\equiv_m\calb\)
   #+END_corollary

   the equivalence of 3 and 5 is known as FraÃ¯ssÃ©'s Theorem. 

   #+ATTR_LATEX: :options []
   #+BEGIN_examplle
   Let \tau be the empty vocabulary and \(\cala\) and \(\calb\) be \(\tau\)-structures. Suppose
   \(\norm{A}\ge m\) and \(\norm{B}\ge m\). Then \(\cala\cong_m\calb\). In fact,
   \((I_j)_{j\le m}:\cala\cong_m\calb\) with
   \(I_j:=\{p\in\Part(\cala,\calb)\mid\norm{\dom(p)}\le m-j\}\)

   As a consequence the class \(\EVEN[\tau]\) of finite \(\tau\)-structures of even cardinality is not
   axiomatizable in first-order logic. In fact, for each \(m>0\), let \(\cala_m\) be a structure of
   cardinality \(m\). Then \(\cala_m\in\EVEN[\tau]\) iff \(\cala_{m+1}\not\in\EVEN[\tau]\), but
   \(\cala_m\cong_m\cala_{m+1}\). Now apply Theorem ref:thm2.2.12.

   *Prove that for arbitrary \tau that \(\EVEN[\tau]\) is not axiomatizable.* <<Problem1>>
   #+END_examplle

   #+ATTR_LATEX: :options []
   #+BEGIN_examplle
   Let \(\tau=\{<,\min,\max\}\) be a vocabulary for finite orderings. Suppose that \(\cala\) and
   \(\calb\) are finite orderings, \(\norm{A}>2^m\) and \(\norm{B}>2^m\) and \(m\ge1\). Then
   \(\cala\cong_m\calb\). Hence the class of finite orderings of even cardinality is not
   axiomatizable in first-order logic. If we consider orderings as \(\{<,S,\min,\max\}\)-structures,
   the last statements remains true

   Given any ordering \(\calc\), we define its distance function \(d\) by
   \begin{equation*}
   d(a,a'):=\norm{\{b\in C\mid(a<b\le a')\text{ or }(a'<b\le a)\}}
   \end{equation*}
   And for \(j\ge0\), we introduce the "truncated" \(j\)-distance function \(d_j\) on \(C\times C\)
   by
   \begin{equation*}
   d_j(a,a'):=
   \begin{cases}
   d(a,a')&\text{ if }d(a,a')<2^j\\
   \infty
   \end{cases}
   \end{equation*}
   Now suppose that \(\cala\) and \(\calb\) are finite orderings with \(\norm{A},\norm{B}>2^m\). For
   \(j\le m\) set
   \begin{equation*}
   I_j:=\{p\in\Part(\cala,\calb)\mid d_j(a,a')=d_j(p(a),p(a'))\text{ for }a,a'\in\dom(p)\}
   \end{equation*}
   Then \((I_j)_{j\le m}:\cala\cong_m\calb\): by assumption on the cardinalities of \(\cala\) and
   \(\calb\) we have \(\{(\min^A,\min^B),(\max^A,\max^B)\}\in I_j\) for every \(j\le m\).
   (As \(d_j(\min,\max)=\infty\)) 
   (Ensure its nonempty and then we can continue by forth property?)
   To give a
   proof of the forth property of \((I_j)_{j\le m}\), suppose \(j<m,p\in I_{j+1}\) and \(a\in A\).
   We distinguish two cases, depending on whether or the following condition
   \begin{equation*}
   \text{there is an }a'\in\dom(p)\text{ s.t. }d_j(a,a')<2^j
   \end{equation*}
   is satisfied. If the condition holds then there is *exactly* one \(b\in B\) for which
   \(p\cup\{(a,b)\})\) is a partial isomorphism preserving \(d_j\)-distances.
   (Note the shape of an ordering)
   Now assume that the
   condition doesn't hold. let \(\dom(p)=\{a_1,\dots,a_r\}\) with \(a_1<\dots<a_r\). We restrict
   outselves to the case \(a_i<a<a_{i+1}\) for some \(i\). Then \(d_j(a_1,a)=\infty\) and
   \(d_j(a,a_{i+1})=\infty\); hence \(d_{j+1}(a_i,a_{i+1})=\infty\) and therefore
   \(d_{j+1}(p(a_i),p(a_{i+1}))=\infty\). Thus there is a \(b\) s.t. \(p(a_i)<b<p(a_{i+1})\),
   \(d_j(p(a_i),b)=\infty\) and \(d_j(b,p(a_{i+1}))=\infty\). We can verify that
   \(q:=p\cup\{(a,b)\}\) is a partial isomorphism
   #+END_examplle

   #+ATTR_LATEX: :options []
   #+BEGIN_examplle
   Let \(\tau=\{<,\min,\max\}\) be as in the preceding example and \(\sigma=\tau\cup\{E\}\) with a
   binary relation symbol \(E\). For \(n\ge3\) let \(\cala_n\) be the ordered \(\tau\)-structure
   with \(A_n=\{0,\dots,n\}\), \(\min^{A_n}=0\), \(\max^{A_n}=n\), where \(<^{A_n}\) is the natural
   ordering on \(A_n\) and
   \begin{equation*}
   E^{A_n}=\{(i,j)\mid\abs{i-j}=2\}\cup
   \{(0,n),(n,0),(1,n-1),(n-1,1)\}
   \end{equation*}
   \((A_n,E^{A_n})\) is a graph that is connected iff \(n\) is odd. Now let \(m\ge2\) and
   \(l,k\ge2^m\)
   
   #+ATTR_LATEX: :width 0.8\textwidth :float t
   [[/media/wu/file/stuuudy/notes/images/FiniteModelTheory/1.png]]

   Let \(I_j\) be the set of partial isomorphism from \(\cala_l|\tau\) to \(\cala_k|\tau\) as
   introduced in the preceding example. We have \((I_j)_{i\le m}:\cala_l|\tau\cong_m\cala_k|\tau\).
   For \(j\ge2\) any \(p\in I_j\) preserves \(E\) too, that is,
   \(I_j\subseteq\Part(\cala_l,\cala_k)\). If \(E^{A_l}ab\) for some \(a,b\in A_l\). Then
   \(d_j(a,b)=4\) or \(\infty\) (since \(l\ge2^m\)). We need to ensure \(4<2^j\) and this is
   why \(j\ge2\) (guess we loose the condition of the definition-.-). If \(d_j(a,b)=4\) then
   clearly \(E^{A_k}p(a)p(b)\). If \(d_j(a,b)=\infty\), a big gap: how to prove \(E^{A_k}p(a)p(b)\) <<Problem2>>

   
   Hence \((I_{j+2})_{j\le m-2}:\cala_l\cong_{m-2}\cala_k\)
   and we have

   the class of finite connected ordered graphs is not first-order axiomatizable
   #+END_examplle

   #+ATTR_LATEX: :options []
   #+BEGIN_examplle
   For \(l\ge1\), let \(\calg_l\) be the graph given by a cycle of length \(l+1\). To be precise,
   set
   \begin{equation*}
   G_l:=\{0,\dots,l\},\dots
   E^{G_l}:=\{(i,i+1)|i<l\}\cup\{(i+1,i)|i<l\}\cup\{(0,l),(l,0)\}
   \end{equation*}
   Thus for \(l,k\in\N\), the disjoint union \(\calg_1\dot\cup\calg_k\) consists of a cyle of length
   \(l+1\) and of a cycle of length \(k+1\). We show
   \begin{equation*}
   \text{if }l,k\ge2^m\text{ then }\calg_l\cong_m\calg_k\text{ and }\calg_l\cong_m
   \calg_l\dot\cup\calg_l
   \end{equation*}
   In fact, for \(j\in\N\), define the distance \(d_j\) on a graph \(\calg\) by
   \begin{equation*}
   d_j(a,a')=
   \begin{cases}
   d(a,b)&\text{if }d(a,b)<2^{j+1}\\
   \infty
   \end{cases}
   \end{equation*}
   We verifies \((I_j)_{j\le m}:\calg_l\cong_m\calg_l\dot\cup\calg_l\) where
   \(I_j\) is the set of \(p\in\Part(\calg_l,\calg\dot\cup\calg_l)\) with
   \begin{equation*}
   \norm{\dom(p)}\le m-j \quad\text{ and }\quad
   d_j(a,b)=d_j(p(a),p(b))\text{ for }a,b\in\dom(p)
   \end{equation*}
   Condition \(d(a,b)<2^{j+1}\) is only to ensure \(\{(\min^A,\min^B),(\max^A,\max^B)\}\in I_j\) for
   every \(j\le m\) as \(l,k\ge 2^m\). 

   For every \(j<m\), \(p\in I_{j+1}\) and \(a\in G_l\), if there is a \(a'\in\dom(p)\)
   s.t. \(d_j(a,a')<2^{j+1}\) then there is a unique \(b\) for which \(q=p\cup\{a,b\}\) is a partial
   isomorphism. Else, let \(\dom(p)=\{a_1,\dots,a_r\}\). Assume \(a_i<a<a_{i+1}\) (abuse of notation
   of course)
   



   We note two consequents.
   - The class CONN of connected finite graphs is not axiomatizable in first-order logic


   \begin{equation*}
\calg_{2^m}\in\text{CONN}, \calg_{2^m}\dot\cup\calg_{2^m}\not\in\text{CONN},
\calg_{2^m}\equiv_m\calg_{2^m}\dot\cup\calg_{2^m}
   \end{equation*}

   - The global relation TC , the relation of transitive closure on the class GRAPH of finite
     graphs, is not first-order definable


   Suppose \(\psi(x,y)\) is a first-order formula defining TC on GRAPH. Then CONN would be the class of
   finite models of \(\forall x \forall y(\neg x=y \to \psi(x,y))\)
   #+END_examplle

   #+BEGIN_exercise
   label:ex2.3.9
   Set \(\tau=\{E\}\). For \(l\ge1\) let \(\calb_l\) and \(\cald_l\) be the \(\tau\)-structures
   given by
   \begin{align*}
&B_l:=\{0,\dots,l\},\quad E^{B_l}:=\{(i,i+1)|i<l\}\\
&D_l:=\{0,\dots,l\},\quad E^{D_l}:=\{(i,i+1)|i<l\}\cup\{(l,0)\}
   \end{align*}
   Given \(m\ge0\), show that \(\calb_l\cong_m\calb_l\dot\cup\cald_l\) for sufficiently large \(l\).
   Conclude that the class of finite acyclic digraphs is not axiomatizable in first-order logic
   #+END_exercise

   #+BEGIN_proof

   
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_proposition
   The product, the disjoint union and the ordered sum preserve \(\equiv_m\)
   #+END_proposition

   #+BEGIN_proof
   Suppose \(\cala_1\equiv\calb_1\) and \(\cala_2\equiv_m\calb_2\). By Ehrenfeucht's Theorem there
   are winning strategies for the duplicator in the games \(G_m(\cala_1,\calb_1)\)
   and \(G_m(\cala_2,\calb_2)\). We refer to these strategies as \(S_1\) and \(S_2\)
   1. \(G_m(\cala_1\times\cala_2,\calb_1\times\calb_2)\): we simultaneously play games
      in \(G_m(\cala_1,\calb_1)\) and \(G_m(\cala_2,\calb_2)\).
   #+END_proof

   #+ATTR_LATEX: :options []
   #+BEGIN_corollary
   1. If \((\cala_1,\bara_1)\equiv_m(\calb_1,\barb_1)\)
      and \((\cala_2,\bara_2)\equiv_m(\calb_2,\barb_2)\) then
      \((\cala_1\dot\cup\cala_2,\bara_1,\bara_2)\equiv_m(\calb_1\dot\cup\calb_2,\barb_1,\barb_2)\)
   2. If \((\cala_1,\bara_1)\equiv_m(\calb_1,\barb_1)\)
      and \((\cala_2,\bara_2)\equiv_m(\calb_2,\barb_2)\) then
      \((\cala_1\lhd\cala_2,\bara_1,\bara_2)\equiv_m(\calb_1\lhd\calb_2,\barb_1,\barb_2)\)
   #+END_corollary

  
** Hanf's Theorem
   All vocabularies in this and the next section will be relational unless stated otherwise. For a
   nonempty subset \(M\) of a structure \(\cala\) we denote by \(\calm\) the substructure
   of \(\cala\) with universe \(M\)

   Given a structure \(\cala\), we define the binary relation \(E^A\) on \(A\) by
   \begin{align*}
E^A:=\{(a,b)|a\neq b,\text{ and }&\text{there are $R$ in $\tau$ and $\barc$ s.t. }R^A\barc\\
&\text{and $a$ and $b$ are components of the tuple }\barc\}
   \end{align*}
   The structure \(\calg(\cala):=(A,E^A)\) is called the *Gaifman graph* of \(\cala\). Obviously,
   if \(\cala\) itself is a graph then \(\calg(\cala)=\cala\). For \(a\in A\) and \(r\in\N\) we
   denote \(S(r,a)\) the *\(r\)-ball* of \(a\)
   \begin{equation*}
S(r,a):=\{b\in A|d(a,b)\le r\}
   \end{equation*}
   (\(d\) is the distance function of \(\calg(\cala)\)). \(\cals(r,a)\) stands for the substructure
   of \(\cala\) with universe \(S(r,a)\). Note that for \(b,c\in S(r,a)\) we have \(d(b,c)\le 2r\).
   For \(\bara=a_1\dots a_s\) we set
   \(S(r,\bara):=S(r,a_1)\cup\dots\cup S(r,a_s)\)

   We define the *\(r\)-ball type* of a point \(a\) in \(\cala\) to be the isomorphism type
   of \((\cals(r,a),a)\), i.e., points \(a\) in \(\cala\) and \(b\) in \(\calb\) have the
   same \(r\)-ball type iff
   \((\cals^{\cala}(r,a),a)\cong(\cals^{\calb}(r,b),b)\)

   #+ATTR_LATEX: :options [Hanf's Theorem]
   #+BEGIN_theorem
   Let \(\cala\) and \(\calb\) be \(\tau\)-structures and let \(m\in\N\). Suppose that for
   some \(e\in\N\) the \(3^m\)-balls in \(\cala\) and \(\calb\) have less than \(e\) elements and
   that for each \(3^m\)-ball type \(\iota\) 1 or 2 holds where
   1. \(\cala\) and \(\calb\) have the same number of elements of \(3^m\)-ball type \iota
   2. both \(\cala\) and \(\calb\) have more than \(m\cdot e\) elements of \(3^m\)-ball type \iota


   Then \(\cala\equiv_m\calb\)
   #+END_theorem

* Problem List
  [[Problem1]]

  [[Problem2]]
